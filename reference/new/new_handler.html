<h1>new_handler</h1>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">namespace std {
  typedef void (*new_handler)();
}</span></code></pre>
</p>
<h2>概要</h2>
<p><code><span style="color: #000">new</span></code>失敗時に呼ばれる関数の型。<a href="http://cpprefjp.github.io/reference/new/set_new_handler.html"><code><span style="color: #000">set_new_handler</span></code></a><code><span style="color: #000">()</span></code>、<a href="http://cpprefjp.github.io/reference/new/get_new_handler.html"><code><span style="color: #000">get_new_handler</span></code></a><code><span style="color: #000">()</span></code>で使用する。 
<code><span style="color: #000">new</span></code>演算子は本来であれば失敗時に<a href="http://cpprefjp.github.io/reference/new/bad_alloc.html"><code><span style="color: #000">bad_alloc</span></code></a>例外を送出するが、これらを使用することで、<code><span style="color: #000">new</span></code>失敗時の動作を任意の関数で置き換えられる。 </p>
<p>ハンドラの内部では、以下のいずれかを行う必要がある：
- 確保済みの領域を解放して<code><span style="color: #000">return</span></code>する
- <a href="http://cpprefjp.github.io/reference/new/bad_alloc.html"><code><span style="color: #000">bad_alloc</span></code></a>またはその派生の例外を送出する
- <code><span style="color: #000">return</span></code>により処理を返すことなく、プログラムの実行を直ちに終了させる(<code><span style="color: #000">quick_exit()</span></code>、<code><span style="color: #000">exit()</span></code>、<code><span style="color: #000">abort()</span></code>などを使用する)</p>
<h2>例</h2>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">#include &lt;iostream&gt;
#include &lt;new&gt;
#include &lt;limits&gt;
#include &lt;cstdlib&gt;

void on_new_failed()
{
  // エラー理由を出力し、プログラムを異常終了させる
  std::cout &lt;&lt; "メモリ確保に失敗した" &lt;&lt; std::endl;
  std::abort();
}

int main()
{
  // new失敗時の動作をカスタマイズ
  std::new_handler handler = on_new_failed;
  std::set_new_handler(handler);

  int* p = new int[std::numeric_limits&lt;std::size_t&gt;::max()];
}</span></code></pre>
</p>
<h3>出力例</h3>
<p><pre><code><span style="color: #000">メモリ確保に失敗した

This application has requested the Runtime to terminate it in an unusual way.
Please contact the application's support team for more information.
</span></code></pre></p>
<footer><a href="https://github.com/cpprefjp/site/edit/master/reference/new/new_handler.md" target="_blank">編集</a></footer>