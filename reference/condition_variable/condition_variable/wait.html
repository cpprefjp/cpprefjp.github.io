<h1>wait (C++11)</h1>
<p><pre class="codehilite"><code class="language-cpp"><a href="http://cpprefjp.github.io/reference/mutex/unique_lock.html">unique_lock</a>&lt;<a href="http://cpprefjp.github.io/reference/mutex/mutex.html">mutex</a>&gt;&amp; lock);

template &lt;class Predicate&gt;
void wait(<a href="http://cpprefjp.github.io/reference/mutex/unique_lock.html">unique_lock</a>&lt;<a href="http://cpprefjp.github.io/reference/mutex/mutex.html">mutex</a>&gt;&amp; lock, Predicate pred);<span style="color: #000">void wait(</span></code></pre>
</p>
<h2>概要</h2>
<p>起床されるまで待機する。</p>
<p>この関数は、処理をするための準備ができたことを<code><span style="color: #000">notify_one()</span></code>/<code><span style="color: #000">notify_all()</span></code>によって通知されるまでスレッドを待機するために使用する。
述語を指定しない場合、<code><span style="color: #000">notify_one()</span></code>/<code><span style="color: #000">notify_all()</span></code>が呼び出された時点でこの関数のブロッキングが解除される。
述語を指定する場合、述語呼び出しが<code><span style="color: #000">true</span></code>になるまで待機を続行する。</p>
<h2>要件</h2>
<ul>
<li><code><span style="color: #000">lock.</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock/owns_lock.html"><code><span style="color: #000">owns_lock()</span></code></a><code><span style="color: #000">== true</span></code>であること</li>
<li><code><span style="color: #000">lock</span></code>が参照しているミューテックスオブジェクトが、この関数を呼び出したスレッドでロック取得されていること</li>
<li><code><span style="color: #000">*this</span></code>の<code><span style="color: #000">condition_variable</span></code>オブジェクトが他スレッドで待機していないか、もしくは並行に待機している全てのスレッドで<code><span style="color: #000">lock</span></code>パラメータが同じミューテックスオブジェクトを参照していること</li>
</ul>
<h2>効果</h2>
<p><code><span style="color: #000">void wait(</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock.html"><code><span style="color: #000">unique_lock</span></code></a><code><span style="color: #000">&lt;</span></code><a href="http://cpprefjp.github.io/reference/mutex/mutex.html"><code><span style="color: #000">mutex</span></code></a><code><span style="color: #000">&gt;&amp; lock);</span></code></p>
<ul>
<li>アトミックに<code><span style="color: #000">lock.</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock/unlock.html"><code><span style="color: #000">unlock()</span></code></a>し、<code><span style="color: #000">*this</span></code>に対してブロッキングする</li>
<li><a href="http://cpprefjp.github.io/reference/condition_variable/condition_variable/notify_one.html"><code><span style="color: #000">notify_one()</span></code></a>/<a href="http://cpprefjp.github.io/reference/condition_variable/condition_variable/notify_all.html"><code><span style="color: #000">notify_all()</span></code></a>もしくはそれ以外の理由で通知があるまでブロッキングされる</li>
<li>この関数を抜ける際に<code><span style="color: #000">lock.</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock/lock.html"><code><span style="color: #000">lock()</span></code></a>する</li>
<li>この関数が例外送出によって終了する場合、関数を抜ける前に<code><span style="color: #000">lock.</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock/lock.html"><code><span style="color: #000">lock()</span></code></a>する</li>
</ul>
<p><code><span style="color: #000">template &lt;class Predicate&gt;</span></code>
<code><span style="color: #000">void wait(</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock.html"><code><span style="color: #000">unique_lock</span></code></a><code><span style="color: #000">&lt;</span></code><a href="http://cpprefjp.github.io/reference/mutex/mutex.html"><code><span style="color: #000">mutex</span></code></a><code><span style="color: #000">&gt;&amp; lock, Predicate pred);</span></code></p>
<p><code><span style="color: #000">while (!pred()) {</span></code>
<code><span style="color: #000">wait(lock);</span></code>
<code><span style="color: #000">}</span></code></p>
<h2>事後条件</h2>
<ul>
<li><code><span style="color: #000">lock.</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock/owns_lock.html"><code><span style="color: #000">owns_lock()</span></code></a><code><span style="color: #000">== true</span></code>であること</li>
<li><code><span style="color: #000">lock</span></code>が参照しているミューテックスオブジェクトが、この関数を呼び出したスレッドでロック取得されていること</li>
</ul>
<h2>戻り値</h2>
<p>なし</p>
<h2>例外</h2>
<p>この関数は、<code><span style="color: #000">lock.</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock/lock.html"><code><span style="color: #000">lock()</span></code></a>および<code><span style="color: #000">lock.</span></code><a href="http://cpprefjp.github.io/reference/mutex/unique_lock/unlock.html"><code><span style="color: #000">unlock()</span></code></a>によって送出されうる、あらゆる例外が送出される可能性がある。</p>
<h2>例</h2>
<p><pre class="codehilite"><code class="language-cpp"><span style="color:#ff0000">wait</span>(lk);
    }
    process_data();
  }

  void wait_for_data_to_process2()
  {
    std::unique_lock&lt;std::mutex&gt; lk(mtx_);

    // データの準備ができるまで待機してから処理する

    // 述語を指定するバージョン
    cond_.<span style="color:#ff0000">wait</span>(lk, [this] { return data_ready_; });
    process_data();
  }

private:
  void process_data()
  {
    // ...データを処理する...
    std::cout &lt;&lt; "process data" &lt;&lt; std::endl;
  }
};

int main()
{
  ProcessData p;

  std::thread t1([&amp;] { p.prepare_data_for_processing(); });
  std::thread t2([&amp;] { p.wait_for_data_to_process1(); });
  std::thread t3([&amp;] { p.wait_for_data_to_process2(); });

  t1.join();
  t2.join();
  t3.join();
}<span style="color: #000">#include &lt;iostream&gt;
#include &lt;condition_variable&gt;
#include &lt;mutex&gt;
#include &lt;thread&gt;

struct ProcessData {
  std::mutex mtx_;
  std::condition_variable cond_;

  bool data_ready_ = false;

public:
  // 処理に必要なデータの準備をする
  void prepare_data_for_processing()
  {
    // ...準備処理...

    {
      std::lock_guard&lt;std::mutex&gt; lk(mtx_);
      data_ready_ = true;
    }

    // 準備完了したので待機スレッドを全て起床させる
    cond_.notify_all();
  }

  void wait_for_data_to_process1()
  {
    std::unique_lock&lt;std::mutex&gt; lk(mtx_);

    // データの準備ができるまで待機してから処理する
    while (!data_ready_) {
      // 述語を指定しないバージョン
      cond_.</span></code></pre>
</p>
<h3>出力</h3>
<p><pre><code><span style="color: #000">process data
process data
</span></code></pre></p>
<h2>バージョン</h2>
<h3>言語</h3>
<ul>
<li>C++11</li>
</ul>
<h3>処理系</h3>
<ul>
<li><a href="http://cpprefjp.github.io/implementation.html#clang">Clang</a>: ??</li>
<li><a href="http://cpprefjp.github.io/implementation.html#gcc">GCC</a>: </li>
<li><a href="http://cpprefjp.github.io/implementation.html#gcc">GCC, C++0x mode</a>: 4.7.0</li>
<li><a href="http://cpprefjp.github.io/implementation.html#icc">ICC</a>: ??</li>
<li><a href="http://cpprefjp.github.io/implementation.html#visual_cpp">Visual C++</a>: 11.0, 12.0</li>
</ul>
<h2>参照</h2>
<footer><a href="https://github.com/cpprefjp/site/edit/master/reference/condition_variable/condition_variable/wait.md" target="_blank">編集</a></footer>