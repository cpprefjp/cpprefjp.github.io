<h1>代入演算子 (C++11)</h1>
<p><pre class="codehilite"><code class="language-cpp"><a href="http://cpprefjp.github.io/reference/memory/unique_ptr.html">unique_ptr</a>&lt;Y, D&gt;&amp;&amp; r);            // (6)<span style="color: #000">shared_ptr&amp; operator=(const shared_ptr&amp; r) noexcept;    // (1)

template &lt;class Y&gt;
shared_ptr&amp; operator=(const shared_ptr&lt;Y&gt;&amp; r) noexcept; // (2)

shared_ptr&amp; operator=(shared_ptr&amp;&amp; r) noexcept;         // (3)

template &lt;class Y&gt;
shared_ptr&amp; operator=(shared_ptr&lt;Y&gt;&amp;&amp; r) noexcept;      // (4)

template &lt;class Y&gt;
shared_ptr&amp; operator=(auto_ptr&lt;Y&gt;&amp;&amp; r);                 // (5)

template &lt;class Y, class D&gt;
shared_ptr&amp; operator=(</span></code></pre>
</p>
<h2>概要</h2>
<ul>
<li>(1), (2) : 自身が保持しているリソースの所有権を放棄し、<code><span style="color: #000">r</span></code>が持つリソースの所有権を共有する。</li>
<li>(3), (4), (5), (6) : 自身が保持しているリソースの所有権を放棄し、<code><span style="color: #000">r</span></code>が持つリソースの所有権を<code><span style="color: #000">*this</span></code>に移動する。</li>
</ul>
<h2>効果</h2>
<ul>
<li>(1), (2) : <a href="http://cpprefjp.github.io/reference/memory/shared_ptr/shared_ptr.html"><code><span style="color: #000">shared_ptr</span></code></a><code><span style="color: #000">(r).</span></code><a href="http://cpprefjp.github.io/reference/memory/shared_ptr/swap.html"><code><span style="color: #000">swap</span></code></a><code><span style="color: #000">(*this)</span></code></li>
<li>(3), (4) : <a href="http://cpprefjp.github.io/reference/memory/shared_ptr/shared_ptr.html"><code><span style="color: #000">shared_ptr</span></code></a><code><span style="color: #000">(std::</span></code><a href="http://cpprefjp.github.io/reference/utility/move.html"><code><span style="color: #000">move</span></code></a><code><span style="color: #000">(r)).</span></code><a href="http://cpprefjp.github.io/reference/memory/shared_ptr/swap.html"><code><span style="color: #000">swap</span></code></a><code><span style="color: #000">(*this)</span></code></li>
<li>(5) : <a href="http://cpprefjp.github.io/reference/memory/shared_ptr/shared_ptr.html"><code><span style="color: #000">shared_ptr</span></code></a><code><span style="color: #000">(r).</span></code><a href="http://cpprefjp.github.io/reference/memory/shared_ptr/swap.html"><code><span style="color: #000">swap</span></code></a><code><span style="color: #000">(*this)</span></code></li>
<li>(6) : <a href="http://cpprefjp.github.io/reference/memory/shared_ptr/shared_ptr.html"><code><span style="color: #000">shared_ptr</span></code></a><code><span style="color: #000">(std::</span></code><a href="http://cpprefjp.github.io/reference/utility/move.html"><code><span style="color: #000">move</span></code></a><code><span style="color: #000">(r)).</span></code><a href="http://cpprefjp.github.io/reference/memory/shared_ptr/swap.html"><code><span style="color: #000">swap</span></code></a><code><span style="color: #000">(*this)</span></code></li>
</ul>
<h2>戻り値</h2>
<p><code><span style="color: #000">*this</span></code></p>
<h2>例外</h2>
<ul>
<li>(1) : 投げない</li>
<li>(2) : 投げない</li>
<li>(3) : 投げない</li>
<li>(4) : 投げない</li>
</ul>
<h2>例</h2>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">#include &lt;cassert&gt;
#include &lt;memory&gt;

int main()
{
  // (1)
  // 自身の所有権を放棄し、
  // 他のshared_ptrオブジェクトとリソースを共有する。
  {
    std::shared_ptr&lt;int&gt; p(new int(3));
    std::shared_ptr&lt;int&gt; q;
    q = p;

    assert(*p.get() == 3);
    assert(p.use_count() == 2);

    assert(*q.get() == 3);
    assert(q.use_count() == 2);
  }

  // (2)
  // 自身の所有権を放棄し、
  // 変換可能なshared_ptrオブジェクトとリソースを共有する。
  {
    std::shared_ptr&lt;int&gt; p(new int(3));
    std::shared_ptr&lt;void&gt; q;
    q = p;

    assert(*p.get() == 3);
    assert(p.use_count() == 2);

    assert(*static_cast&lt;int*&gt;(q.get()) == 3);
    assert(q.use_count() == 2);
  }

  // (3)
  // 自身の所有権を放棄し、
  // 他のshared_ptrから所有権を移動する
  {
    std::shared_ptr&lt;int&gt; p(new int(3));
    std::shared_ptr&lt;int&gt; q;
    q = std::move(p);

    // 移動元は空の状態になる
    assert(p.get() == nullptr);
    assert(p.use_count() == 0);

    assert(*q.get() == 3);
    assert(q.use_count() == 1);
  }

  // (6)
  // 自身の所有権を放棄し、
  // unique_ptrオブジェクトから所有権を移動する
  {
    std::unique_ptr&lt;int&gt; p(new int(3));
    std::shared_ptr&lt;int&gt; q;
    q = std::move(p);

    // 移動元は空の状態になる
    assert(p.get() == nullptr);

    assert(*q.get() == 3);
    assert(q.use_count() == 1);
  }
}</span></code></pre>
</p>
<h3>出力</h3>
<p><pre><code><span style="color: #000"></span></code></pre></p>
<h2>バージョン</h2>
<h3>言語</h3>
<ul>
<li>C++11</li>
</ul>
<h3>処理系</h3>
<ul>
<li><a href="http://cpprefjp.github.io/implementation.html#gcc">GCC</a>: 4.3.6(unique_ptr以外), 4.4.7</li>
<li><a href="http://cpprefjp.github.io/implementation.html#clang">Clang libc++, C++11 mode</a>: 3.0</li>
<li><a href="http://cpprefjp.github.io/implementation.html#icc">ICC</a>: ?</li>
<li><a href="http://cpprefjp.github.io/implementation.html#visual_cpp">Visual C++</a>: 9.0 (TR1), 10.0, 11.0, 12.0<ul>
<li>Visual C++ 9.0は(1), (2), (5)変形のみ</li>
<li>Visual C++ 9.0, 1.0の(5)は、仮引数の型が<code><span style="color: #000">auto_ptr&lt;Y&gt;&amp;&amp;</span></code>ではなく<code><span style="color: #000">auto_ptr&lt;Y&gt;&amp;</span></code>になっている。</li>
</ul>
</li>
</ul>
<footer><a href="https://github.com/cpprefjp/site/edit/master/reference/memory/shared_ptr/op_assign.md" target="_blank">編集</a></footer>