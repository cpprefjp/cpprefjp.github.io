<h1>コンストラクタ (C++11)</h1>
<p><pre class="codehilite"><code class="language-cpp"><a href="http://cpprefjp.github.io/reference/memory/shared_ptr.html">shared_ptr</a>&lt;Y&gt;&amp; r) noexcept; // (4)<span style="color: #000">constexpr weak_ptr() noexcept;             // (1)
weak_ptr(const weak_ptr&amp; r) noexcept;      // (2)

template &lt;class Y&gt;
weak_ptr(const weak_ptr&lt;Y&gt;&amp; r) noexcept;   // (3)

template &lt;class Y&gt;
weak_ptr(const </span></code></pre>
</p>
<h2>weak_ptrオブジェクトの構築</h2>
<ul>
<li>(1) : デフォルトコンストラクタ。監視対象を持たない、空の<code><span style="color: #000">weak_ptr</span></code>オブジェクトを構築する。</li>
<li>(2) : コピーコンストラクタ。監視対象をコピーする。</li>
<li>(3) : 変換可能な<code><span style="color: #000">weak_ptr</span></code>の監視対象をコピーする。</li>
<li>(4) : <a href="http://cpprefjp.github.io/reference/memory/shared_ptr.html"><code><span style="color: #000">shared_ptr</span></code></a>オブジェクト<code><span style="color: #000">r</span></code>を監視する。</li>
</ul>
<h2>要件</h2>
<ul>
<li>(3), (4) : <code><span style="color: #000">Y*</span></code>が<code><span style="color: #000">T*</span></code>に暗黙変換可能であること。</li>
</ul>
<h2>効果</h2>
<ul>
<li>(1) : 監視対象を持たない、空の<code><span style="color: #000">weak_ptr</span></code>オブジェクトを構築する。</li>
<li>(2), (3) : <code><span style="color: #000">r</span></code>が空である場合、空の<code><span style="color: #000">weak_ptr</span></code>オブジェクトを構築する。そうでなければ、<code><span style="color: #000">r</span></code>の監視対象を<code><span style="color: #000">*this</span></code>にコピーする。</li>
<li>(4) : <code><span style="color: #000">r</span></code>を<code><span style="color: #000">*this</span></code>の監視対象とする。</li>
</ul>
<h2>事後条件</h2>
<ul>
<li>(1) : <a href="http://cpprefjp.github.io/reference/memory/weak_ptr/use_count.html"><code><span style="color: #000">use_count()</span></code></a> <code><span style="color: #000">== 0</span></code></li>
<li>(2), (3), (4) : <a href="http://cpprefjp.github.io/reference/memory/weak_ptr/use_count.html"><code><span style="color: #000">use_count()</span></code></a> <code><span style="color: #000">==</span></code> <code><span style="color: #000">r.</span></code><a href="http://cpprefjp.github.io/reference/memory/weak_ptr/use_count.html"><code><span style="color: #000">use_count()</span></code></a></li>
</ul>
<h2>例</h2>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">#include &lt;cassert&gt;
#include &lt;iostream&gt;
#include &lt;memory&gt;

int main()
{
  // (1)
  // 監視対象を持たない、空のweak_ptrオブジェクトを構築する。
  std::weak_ptr&lt;int&gt; wp1;
  assert(wp1.use_count() == 0);

  // (2)
  // 他のweak_ptrオブジェクトの監視対象をコピーする
  std::shared_ptr&lt;int&gt; sp2(new int(3));
  std::weak_ptr&lt;int&gt; wp2_org = sp2; // wp2_orgはsp2を監視する
  std::weak_ptr&lt;int&gt; wp2 = wp2_org; // wp2_orgの監視対象をコピーする

  if (std::shared_ptr&lt;int&gt; r = wp2.lock()) {
    std::cout &lt;&lt; *r &lt;&lt; std::endl;
  }

  // (3)
  // 変換可能なweak_ptrオブジェクトの監視対象をコピーする
  std::shared_ptr&lt;int&gt; sp3(new int(3));
  std::weak_ptr&lt;int&gt; wp3_org = sp3;
  std::weak_ptr&lt;void&gt; wp3 = wp3_org;

  if (std::shared_ptr&lt;int&gt; r = std::static_pointer_cast&lt;int&gt;(wp3.lock())) {
    std::cout &lt;&lt; *r &lt;&lt; std::endl;
  }

  // (4)
  // shared_ptrオブジェクトを監視する
  std::shared_ptr&lt;int&gt; sp4(new int(3));
  std::weak_ptr&lt;int&gt; wp4 = sp4;

  if (std::shared_ptr&lt;int&gt; r = wp4.lock()) {
    std::cout &lt;&lt; *r &lt;&lt; std::endl;
  }
}</span></code></pre>
</p>
<h3>出力</h3>
<p><pre><code><span style="color: #000">3
3
3
</span></code></pre></p>
<h2>バージョン</h2>
<h3>言語</h3>
<ul>
<li>C++11</li>
</ul>
<h3>処理系</h3>
<ul>
<li><a href="http://cpprefjp.github.io/implementation.html#gcc">GCC, C++11 mode</a>: 4.3.6</li>
<li><a href="http://cpprefjp.github.io/implementation.html#clang">Clang libc++, C++11 mode</a>: 3.0</li>
<li><a href="http://cpprefjp.github.io/implementation.html#icc">ICC</a>: ?</li>
<li><a href="http://cpprefjp.github.io/implementation.html#visual_cpp">Visual C++</a>: ?</li>
</ul>
<footer><a href="https://github.com/cpprefjp/site/edit/master/reference/memory/weak_ptr/weak_ptr.md" target="_blank">編集</a></footer>