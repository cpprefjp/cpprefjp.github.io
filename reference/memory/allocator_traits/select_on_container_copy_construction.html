<h1>select_on_container_copy_construction (C++11)</h1>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">static Alloc select_on_container_copy_construction(const Alloc&amp; a);</span></code></pre>
</p>
<h2>概要</h2>
<p>コンテナのコピー構築に使用するアロケータオブジェクトを取得する。</p>
<h2>戻り値</h2>
<p><code><span style="color: #000">a.select_on_container_copy_construction()</span></code>という式が有効ならその戻り値を返し、そうでなければデフォルト実装として<code><span style="color: #000">a</span></code>を返す。</p>
<h2>備考</h2>
<p>この関数は、標準コンテナのコピーコンストラクタで呼び出され、この関数の戻り値であるアロケータオブジェクトを、コピーに必要なメモリ確保・解放、オブジェクトの構築・破棄に使用する。</p>
<h2>例</h2>
<p><pre class="codehilite"><code class="language-cpp"><span style="color:#ff0000">select_on_container_copy_construction</span>(alloc_)) {}

  ~MyVector()
  {
    release();
  }

private:
  void release()
  {
    if (!data_)
      return;

    using traits = std::allocator_traits&lt;Alloc&gt;;

    // 要素を破棄
    for (std::size_t i = 0; i &lt; size_; ++i) {
      traits::destroy(alloc_, &amp;data_[i]);
    }

    // メモリを解放
    traits::deallocate(alloc_, data_, size_);

    size_ = 0;
    data_ = nullptr;
  }
};

int main()
{
  MyVector&lt;int, std::allocator&lt;int&gt;&gt; a;
  MyVector&lt;int, std::allocator&lt;int&gt;&gt; b = a;
}<span style="color: #000">#include &lt;iostream&gt;
#include &lt;memory&gt;

template &lt;class T, class Alloc&gt;
class MyVector {
  T* data_;
  std::size_t size_;
  Alloc alloc_;
public:
  MyVector()
    : data_(nullptr), size_(0) {}

  MyVector(std::size_t size)
  {
    using traits = std::allocator_traits&lt;Alloc&gt;;

    size_ = size;
    data_ = traits::allocate(alloc_, size);

    for (std::size_t i = 0; i &lt; size_; ++i) {
      traits::construct(alloc_, &amp;data_[i]);
    }
  }

  MyVector(const MyVector&amp; other, Alloc alloc)
  {
    alloc_ = alloc; // 受け取ったアロケータをメンバ変数に保持する

    // 受け取ったアロケータでメモリ確保
    using traits = std::allocator_traits&lt;Alloc&gt;;
    size_ = other.size_;
    data_ = traits::allocate(alloc_, size_);

    for (std::size_t i = 0; i &lt; size_; ++i) {
      traits::construct(alloc_, &amp;data_[i], other.data_[i]);
    }
  }

  // コピー構築に使用するアロケータオブジェクトを取得し、
  // アロケータを受け取るコピーコンストラクタに移譲
  MyVector(const MyVector&amp; other)
    : MyVector(
        other,
        std::allocator_traits&lt;Alloc&gt;::</span></code></pre>
</p>
<h3>出力</h3>
<p><pre><code><span style="color: #000"></span></code></pre></p>
<h2>バージョン</h2>
<h3>言語</h3>
<ul>
<li>C++11</li>
</ul>
<h3>処理系</h3>
<ul>
<li><a href="http://cpprefjp.github.io/implementation.html#clang">Clang</a>: ??</li>
<li><a href="http://cpprefjp.github.io/implementation.html#gcc">GCC</a>: </li>
<li><a href="http://cpprefjp.github.io/implementation.html#gcc">GCC, C++0x mode</a>: 4.7.0</li>
<li><a href="http://cpprefjp.github.io/implementation.html#icc">ICC</a>: ??</li>
<li><a href="http://cpprefjp.github.io/implementation.html#visual_cpp">Visual C++</a>: 11.0, 12.0</li>
</ul>
<footer><a href="https://github.com/cpprefjp/site/edit/master/reference/memory/allocator_traits/select_on_container_copy_construction.md" target="_blank">編集</a></footer>